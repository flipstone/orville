<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.Orville.PostgreSQL.Internal.PrimaryKey</span><span>
</span><a name="line-3"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyIn"><span class="hs-identifier hs-var">primaryKeyIn</span></a><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyEquals"><span class="hs-identifier hs-var">primaryKeyEquals</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyDescription"><span class="hs-identifier hs-var">primaryKeyDescription</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyToSql"><span class="hs-identifier hs-var">primaryKeyToSql</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKey"><span class="hs-identifier hs-var">primaryKey</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#compositePrimaryKey"><span class="hs-identifier hs-var">compositePrimaryKey</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyPart"><span class="hs-identifier hs-var">primaryKeyPart</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#mapPrimaryKeyParts"><span class="hs-identifier hs-var">mapPrimaryKeyParts</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">List</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Database.HDBC</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">HDBC</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.FieldDefinition.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Internal.FieldDefinition</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.FieldDefinition.html#fieldToSqlValue"><span class="hs-identifier hs-var">fieldToSqlValue</span></a><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Internal.Types</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKeyPart"><span class="hs-identifier hs-type">PrimaryKeyPart</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition</span></a><span class="hs-special">(</span><span class="hs-identifier">fieldName</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#NotNull"><span class="hs-identifier hs-type">NotNull</span></a><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html"><span class="hs-identifier">Database.Orville.PostgreSQL.Internal.Where</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.Where.html#WhereCondition"><span class="hs-identifier hs-type">WhereCondition</span></a><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#whereIn"><span class="hs-identifier hs-var">whereIn</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.Where.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#whereAnd"><span class="hs-identifier hs-var">whereAnd</span></a><span class="hs-special">,</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#whereOr"><span class="hs-identifier hs-var">whereOr</span></a><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-comment">{-|
  'primaryKeyIn' builds a 'WhereCondition' that will match all rows where the
  primary key is equal to one of the given values. For single-field primary
  keys this is equivalent to 'whereIn', but 'primaryKeyIn' also handles
  composite primary keys.
-}</span><span>
</span><a name="line-26"></a><span class="hs-identifier">primaryKeyIn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a><span> </span><a href="#local-6989586621679110816"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679110816"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#WhereCondition"><span class="hs-identifier hs-type">WhereCondition</span></a><span>
</span><a name="line-27"></a><a name="primaryKeyIn"><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyIn"><span class="hs-identifier">primaryKeyIn</span></a></a><span> </span><a name="local-6989586621679110817"><a href="#local-6989586621679110817"><span class="hs-identifier">keyDef</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-var">PrimaryKey</span></a><span> </span><a name="local-6989586621679110818"><a href="#local-6989586621679110818"><span class="hs-identifier">first</span></a></a><span> </span><a name="local-6989586621679110819"><a href="#local-6989586621679110819"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679110820"><a href="#local-6989586621679110820"><span class="hs-identifier">keys</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679110819"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-29"></a><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-30"></a><span>      </span><span class="hs-comment">-- Special case the single field case to an in clause rather</span><span>
</span><a name="line-31"></a><span>      </span><span class="hs-comment">-- than a large OR</span><span>
</span><a name="line-32"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679110818"><span class="hs-identifier hs-var">first</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-33"></a><span>        </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKeyPart"><span class="hs-identifier hs-var">PrimaryKeyPart</span></a><span> </span><a name="local-6989586621679110821"><a href="#local-6989586621679110821"><span class="hs-identifier">getPart</span></a></a><span> </span><a name="local-6989586621679110822"><a href="#local-6989586621679110822"><span class="hs-identifier">field</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-34"></a><span>          </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#whereIn"><span class="hs-identifier hs-var">whereIn</span></a><span> </span><a href="#local-6989586621679110822"><span class="hs-identifier hs-var">field</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679110821"><span class="hs-identifier hs-var">getPart</span></a><span> </span><a href="#local-6989586621679110820"><span class="hs-identifier hs-var">keys</span></a><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-36"></a><span>      </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#whereOr"><span class="hs-identifier hs-var">whereOr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyEquals"><span class="hs-identifier hs-var">primaryKeyEquals</span></a><span> </span><a href="#local-6989586621679110817"><span class="hs-identifier hs-var">keyDef</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679110820"><span class="hs-identifier hs-var">keys</span></a><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-comment">{-|
  'primaryKeyEquals' builds a 'WhereCondition' that will match the row where
  the primary key is equal to the given value. For single-field primary keys
  this is equivalent to '.==', but 'primaryKeyEquals also handles composite
  primary keys.
-}</span><span>
</span><a name="line-44"></a><span class="hs-identifier">primaryKeyEquals</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a><span> </span><a href="#local-6989586621679110815"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679110815"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#WhereCondition"><span class="hs-identifier hs-type">WhereCondition</span></a><span>
</span><a name="line-45"></a><a name="primaryKeyEquals"><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyEquals"><span class="hs-identifier">primaryKeyEquals</span></a></a><span> </span><a name="local-6989586621679110823"><a href="#local-6989586621679110823"><span class="hs-identifier">keyDef</span></a></a><span> </span><a name="local-6989586621679110824"><a href="#local-6989586621679110824"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-47"></a><span>    </span><a name="local-6989586621679110825"><a href="#local-6989586621679110825"><span class="hs-identifier">partEq</span></a></a><span> </span><a name="local-6989586621679110826"><a href="#local-6989586621679110826"><span class="hs-identifier">getPart</span></a></a><span> </span><a name="local-6989586621679110827"><a href="#local-6989586621679110827"><span class="hs-identifier">partField</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-48"></a><span>      </span><a href="#local-6989586621679110827"><span class="hs-identifier hs-var">partField</span></a><span> </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a><span> </span><a href="#local-6989586621679110826"><span class="hs-identifier hs-var">getPart</span></a><span> </span><a href="#local-6989586621679110824"><span class="hs-identifier hs-var">key</span></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-50"></a><span>    </span><a href="Database.Orville.PostgreSQL.Internal.Where.html#whereAnd"><span class="hs-identifier hs-var">whereAnd</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#mapPrimaryKeyParts"><span class="hs-identifier hs-var">mapPrimaryKeyParts</span></a><span> </span><a href="#local-6989586621679110825"><span class="hs-identifier hs-var">partEq</span></a><span> </span><a href="#local-6989586621679110823"><span class="hs-identifier hs-var">keyDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-comment">{-|
  'primaryKeyDescription' builds a user-readable representation of the
  primary key for use in error messages and such. It is a comma-delimited
  list of the names of the fields that make up the primary key.
-}</span><span>
</span><a name="line-57"></a><span class="hs-identifier">primaryKeyDescription</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a><span> </span><a href="#local-6989586621679110814"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-58"></a><a name="primaryKeyDescription"><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyDescription"><span class="hs-identifier">primaryKeyDescription</span></a></a><span> </span><a name="local-6989586621679110828"><a href="#local-6989586621679110828"><span class="hs-identifier">keyDef</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-60"></a><span>    </span><a name="local-6989586621679110829"><a href="#local-6989586621679110829"><span class="hs-identifier">partName</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679110830"><a href="#local-6989586621679110830"><span class="hs-identifier">field</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-61"></a><span>      </span><span class="hs-identifier">fieldName</span><span> </span><a href="#local-6989586621679110830"><span class="hs-identifier hs-var">field</span></a><span>
</span><a name="line-62"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-identifier hs-var">List.intercalate</span><span> </span><span class="hs-string">&quot;, &quot;</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#mapPrimaryKeyParts"><span class="hs-identifier hs-var">mapPrimaryKeyParts</span></a><span> </span><a href="#local-6989586621679110829"><span class="hs-identifier hs-var">partName</span></a><span> </span><a href="#local-6989586621679110828"><span class="hs-identifier hs-var">keyDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">{-|
  'primaryKeyToSql' converts a Haskell value for a primary key into the
  (possibly multiple) sql values that represent the primary key in the
  database.
-}</span><span>
</span><a name="line-70"></a><span class="hs-identifier">primaryKeyToSql</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a><span> </span><a href="#local-6989586621679110813"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679110813"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">HDBC.SqlValue</span><span class="hs-special">]</span><span>
</span><a name="line-71"></a><a name="primaryKeyToSql"><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyToSql"><span class="hs-identifier">primaryKeyToSql</span></a></a><span> </span><a name="local-6989586621679110831"><a href="#local-6989586621679110831"><span class="hs-identifier">keyDef</span></a></a><span> </span><a name="local-6989586621679110832"><a href="#local-6989586621679110832"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-73"></a><span>    </span><a name="local-6989586621679110833"><a href="#local-6989586621679110833"><span class="hs-identifier">partSqlValue</span></a></a><span> </span><a name="local-6989586621679110834"><a href="#local-6989586621679110834"><span class="hs-identifier">getPart</span></a></a><span> </span><a name="local-6989586621679110835"><a href="#local-6989586621679110835"><span class="hs-identifier">partField</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-74"></a><span>      </span><a href="Database.Orville.PostgreSQL.Internal.FieldDefinition.html#fieldToSqlValue"><span class="hs-identifier hs-var">fieldToSqlValue</span></a><span> </span><a href="#local-6989586621679110835"><span class="hs-identifier hs-var">partField</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679110834"><span class="hs-identifier hs-var">getPart</span></a><span> </span><a href="#local-6989586621679110832"><span class="hs-identifier hs-var">key</span></a><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-76"></a><span>    </span><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#mapPrimaryKeyParts"><span class="hs-identifier hs-var">mapPrimaryKeyParts</span></a><span> </span><a href="#local-6989586621679110833"><span class="hs-identifier hs-var">partSqlValue</span></a><span> </span><a href="#local-6989586621679110831"><span class="hs-identifier hs-var">keyDef</span></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-comment">{-|
  'primaryKey' constructs a single-field primary key from the 'FieldDefinition'
  that corresponds to the primary key's column. This is generally used while
  building a 'TableDefinition'.
-}</span><span>
</span><a name="line-83"></a><span class="hs-identifier">primaryKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition</span></a><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#NotNull"><span class="hs-identifier hs-type">NotNull</span></a><span> </span><a href="#local-6989586621679110812"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a><span> </span><a href="#local-6989586621679110812"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-84"></a><a name="primaryKey"><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKey"><span class="hs-identifier">primaryKey</span></a></a><span> </span><a name="local-6989586621679110836"><a href="#local-6989586621679110836"><span class="hs-identifier">fieldDef</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-85"></a><span>  </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-var">PrimaryKey</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKeyPart"><span class="hs-identifier hs-var">PrimaryKeyPart</span></a><span> </span><span class="hs-identifier hs-var">id</span><span> </span><a href="#local-6989586621679110836"><span class="hs-identifier hs-var">fieldDef</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">{-|
  'compositePrimaryKey' constructs a multi-field primary key from the given
  parts, each of which corresponds to one field in the primary key.  You should
  use this while building a 'TableDefinition' for a table that you want to have
  a multi-column primary key. See 'primaryKeyPart' for how to build the parts
  to be passed as parameters. Note: there is no special significance to the
  first argument other than requiring that there is at least one field in the
  primary key.
-}</span><span>
</span><a name="line-96"></a><span class="hs-identifier">compositePrimaryKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKeyPart"><span class="hs-identifier hs-type">PrimaryKeyPart</span></a><span> </span><a href="#local-6989586621679110811"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-97"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKeyPart"><span class="hs-identifier hs-type">PrimaryKeyPart</span></a><span> </span><a href="#local-6989586621679110811"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">]</span><span>
</span><a name="line-98"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a><span> </span><a href="#local-6989586621679110811"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-99"></a><a name="compositePrimaryKey"><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#compositePrimaryKey"><span class="hs-identifier">compositePrimaryKey</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-100"></a><span>  </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-var">PrimaryKey</span></a><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">{-|
  'primaryKeyPart' builds on section of a composite primary key based on the
  field definition that corresponds to that column of the primary key. The
  function given is used to decompose the Haskell value for the composite key
  into the individual parts so they can be converted to sql for things like
  building 'WhereCondition'
-}</span><span>
</span><a name="line-109"></a><span class="hs-identifier">primaryKeyPart</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679110809"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679110810"><span class="hs-identifier hs-type">part</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition</span></a><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#NotNull"><span class="hs-identifier hs-type">NotNull</span></a><span> </span><a href="#local-6989586621679110810"><span class="hs-identifier hs-type">part</span></a><span>
</span><a name="line-111"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKeyPart"><span class="hs-identifier hs-type">PrimaryKeyPart</span></a><span> </span><a href="#local-6989586621679110809"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-112"></a><a name="primaryKeyPart"><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#primaryKeyPart"><span class="hs-identifier">primaryKeyPart</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-113"></a><span>  </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKeyPart"><span class="hs-identifier hs-var">PrimaryKeyPart</span></a><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">{-|
  'mapPrimaryKeyParts' provides a way to access the innards of a 'PrimaryKey'
  definition to extract information. The given function will be called on
  each part of the primary key in order and the list of results is returned.
  Note that single-field and multi-field primary keys are treated the same by
  this function, with the single-field case simply behaving as composite key
  with just one part.
-}</span><span>
</span><a name="line-123"></a><span class="hs-identifier">mapPrimaryKeyParts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679110808"><a href="#local-6989586621679110808"><span class="hs-identifier">part</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-124"></a><span>                         </span><span class="hs-special">(</span><a href="#local-6989586621679110806"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679110808"><span class="hs-identifier hs-type">part</span></a><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition</span></a><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#NotNull"><span class="hs-identifier hs-type">NotNull</span></a><span> </span><a href="#local-6989586621679110808"><span class="hs-identifier hs-type">part</span></a><span>
</span><a name="line-126"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679110807"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-127"></a><span>                      </span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-type">PrimaryKey</span></a><span> </span><a href="#local-6989586621679110806"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-129"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679110807"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-130"></a><a name="mapPrimaryKeyParts"><a href="Database.Orville.PostgreSQL.Internal.PrimaryKey.html#mapPrimaryKeyParts"><span class="hs-identifier">mapPrimaryKeyParts</span></a></a><span> </span><a name="local-6989586621679110837"><a href="#local-6989586621679110837"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKey"><span class="hs-identifier hs-var">PrimaryKey</span></a><span> </span><a name="local-6989586621679110838"><a href="#local-6989586621679110838"><span class="hs-identifier">first</span></a></a><span> </span><a name="local-6989586621679110839"><a href="#local-6989586621679110839"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-132"></a><span>    </span><a name="local-6989586621679110840"><a href="#local-6989586621679110840"><span class="hs-identifier">doPart</span></a></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.PostgreSQL.Internal.Types.html#PrimaryKeyPart"><span class="hs-identifier hs-var">PrimaryKeyPart</span></a><span> </span><a name="local-6989586621679110841"><a href="#local-6989586621679110841"><span class="hs-identifier">getPart</span></a></a><span> </span><a name="local-6989586621679110842"><a href="#local-6989586621679110842"><span class="hs-identifier">field</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-133"></a><span>      </span><a href="#local-6989586621679110837"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679110841"><span class="hs-identifier hs-var">getPart</span></a><span> </span><a href="#local-6989586621679110842"><span class="hs-identifier hs-var">field</span></a><span>
</span><a name="line-134"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679110840"><span class="hs-identifier hs-var">doPart</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679110838"><span class="hs-identifier hs-var">first</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679110839"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a></pre></body></html>